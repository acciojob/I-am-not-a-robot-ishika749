<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>I'm not a robot verification</title>
<style>
  #image-container {
    display: flex;
    flex-wrap: wrap;
    max-width: 600px;
    gap: 10px;
    margin-bottom: 10px;
  }
  #image-container img {
    width: 100px;
    height: 100px;
    cursor: pointer;
    border: 2px solid transparent;
    object-fit: cover;
  }
  #image-container img.selected {
    border-color: blue;
    opacity: 0.7;
  }
  #buttons {
    margin-top: 10px;
  }
  button {
    margin-right: 10px;
  }
</style>
</head>
<body>

<h3 id="h">Please click on the identical tiles to verify that you are not a robot.</h3>
<div id="image-container"></div>
<div id="buttons">
  <button id="reset" style="display:none;">Reset</button>
  <button id="verify" style="display:none;">Verify</button>
</div>
<p id="para"></p>

<script>
  (function() {
    const imagesSrc = [
      'https://picsum.photos/id/1011/100/100',
      'https://picsum.photos/id/1012/100/100',
      'https://picsum.photos/id/1013/100/100',
      'https://picsum.photos/id/1015/100/100',
      'https://picsum.photos/id/1016/100/100'
    ];

    const container = document.getElementById('image-container');
    const resetBtn = document.getElementById('reset');
    const verifyBtn = document.getElementById('verify');
    const message = document.getElementById('h');
    const para = document.getElementById('para');

    let tiles = [];
    let selectedIndices = [];

    // Utility: Shuffle array
    function shuffleArray(array) {
      for(let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Setup images with one duplicate randomly chosen
    function setupTiles() {
      // Pick a random image index to duplicate
      const duplicateIndex = Math.floor(Math.random() * imagesSrc.length);
      // Copy images
      let tilesArray = [...imagesSrc];
      // Add duplicate of chosen image
      tilesArray.push(imagesSrc[duplicateIndex]);

      // Shuffle tiles
      tiles = shuffleArray(tilesArray);

      // Reset selections & UI
      selectedIndices = [];
      container.innerHTML = '';
      para.textContent = '';
      resetBtn.style.display = 'none';
      verifyBtn.style.display = 'none';
      message.textContent = 'Please click on the identical tiles to verify that you are not a robot.';

      // Render images
      tiles.forEach((src, idx) => {
        const img = document.createElement('img');
        img.src = src;
        img.dataset.index = idx;
        img.addEventListener('click', imageClickHandler);
        container.appendChild(img);
      });
    }

    // Reset everything
    function reset() {
      selectedIndices = [];
      para.textContent = '';
      verifyBtn.style.display = 'none';
      resetBtn.style.display = 'none';
      message.textContent = 'Please click on the identical tiles to verify that you are not a robot.';
      // Remove selected styles
      [...container.children].forEach(img => img.classList.remove('selected'));
    }

    // Click handler for images
    function imageClickHandler(e) {
      const idx = Number(e.target.dataset.index);

      // If already selected, ignore clicks on the same tile twice
      if(selectedIndices.includes(idx)) return;

      // If already two selected, ignore additional clicks
      if(selectedIndices.length >= 2) return;

      selectedIndices.push(idx);
      e.target.classList.add('selected');

      if(selectedIndices.length === 1) {
        // Show reset button on first click
        resetBtn.style.display = 'inline-block';
      }

      if(selectedIndices.length === 2) {
        // Show verify button on second click only if two different tiles clicked
        verifyBtn.style.display = 'inline-block';
      }
    }

    // Verify selection
    function verify() {
      if(selectedIndices.length !== 2) return;

      const [first, second] = selectedIndices;
      const firstImg = tiles[first];
      const secondImg = tiles[second];

      if(firstImg === secondImg) {
        message.textContent = "You are a human. Congratulations!";
      } else {
        message.textContent = "We can't verify you as a human. You selected the non-identical tiles.";
      }

      // Hide verify button after verifying
      verifyBtn.style.display = 'none';
    }

    // Event Listeners
    resetBtn.addEventListener('click', () => {
      reset();
    });

    verifyBtn.addEventListener('click', () => {
      verify();
    });

    // Initialize on page load
    window.onload = setupTiles;

  })();
</script>

</body>
</html>
